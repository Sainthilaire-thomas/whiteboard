# Documentation SchÃ©ma Public - 000-CADO

## Vue d'Ensemble

Le schÃ©ma `public` constitue le **cÅ“ur mÃ©tier** de la plateforme 000-CADO avec **46 tables** organisÃ©es en **8 domaines fonctionnels** . Il orchestre le pipeline complet : **Appel â†’ Ã‰valuation â†’ Coaching â†’ Suivi** , tout en servant de hub central pour les relations avec les 11 autres schÃ©mas spÃ©cialisÃ©s.

### Statistiques GÃ©nÃ©rales

- **46 tables** rÃ©parties en 8 domaines fonctionnels
- **39 sÃ©quences** pour auto-incrÃ©mentation
- **58 index** dont 3 spÃ©cialisÃ©s pour l'interface sidebar
- **48 relations** intra-schÃ©ma + 18 relations cross-schÃ©mas
- **13 colonnes JSONB** pour structures de donnÃ©es complexes
- **1 trigger automatique** pour calcul de durÃ©e des appels

## Architecture par Domaines Fonctionnels

### ğŸ¢ **1. Gestion Utilisateurs & Entreprises** (6 tables)

#### Tables Principales

- **`users`** : Utilisateurs de la plateforme (coaches, administrateurs)
- **`entreprises`** : Entreprises clientes multi-tenant
- **`conseillers`** : Conseillers/coaches rattachÃ©s aux entreprises
- **`avatars`** : Avatars pour personnalisation et anonymisation
- **`user_enterprises`** : Relation Many-to-Many utilisateurs â†” entreprises
- **`user_roles`** : RÃ´les personnalisÃ©s par utilisateur

#### Relations ClÃ©s

```sql
-- Architecture multi-tenant sÃ©curisÃ©e
users.entreprise_id â†’ entreprises.identreprise (NO ACTION)
conseillers.entreprise â†’ entreprises.identreprise (CASCADE DELETE)
conseillers.idavatar â†’ avatars.idavatar (NO ACTION)
```

#### ParticularitÃ©s

- **Anonymisation** : `conseillers.estanonyme` + `avatars.anonyme` pour protection identitÃ©
- **Multi-appartenance** : Table `user_enterprises` pour utilisateurs multi-entreprises
- **SÃ©curitÃ© forte** : Email unique sur `users` et `conseillers`

### ğŸ“ **2. Gestion des Appels & Transcriptions** (4 tables)

#### Pipeline de Transcription

```
call (enregistrement) â†’ transcript (structure) â†’ word (mot-par-mot) â†’ roleplaydata (jeu de rÃ´le)
```

#### **Table `call` - Hub Central des Appels**

```sql
-- Colonnes critiques
transcription JSONB,           -- Structure complÃ¨te avec timestamps
duree NUMERIC,                -- CalculÃ©e automatiquement par trigger
status VARCHAR(20) DEFAULT 'non_supervisÃ©',  -- Pipeline d'Ã©valuation
is_tagging_call BOOLEAN DEFAULT false        -- Appel en cours d'Ã©valuation
```

**Trigger Automatique** :

```sql
CREATE TRIGGER trigger_update_duree
BEFORE INSERT OR UPDATE ON call
FOR EACH ROW EXECUTE FUNCTION update_duree();
```

#### **Table `word` - Analyse Granulaire**

- **GranularitÃ© maximale** : Chaque mot avec `startTime` et `endTime`
- **RÃ©fÃ©rencement prÃ©cis** : UtilisÃ© par `whiteboard` pour annotations mot-par-mot
- **Relations CASCADE** : `word.transcriptid â†’ transcript.transcriptid`

#### **Table `roleplaydata` - Jeu de RÃ´le IA**

- **IntÃ©gration whiteboard** : `postit_id` pour collaboration temps rÃ©el
- **DonnÃ©es JSON** : `note` pour stockage des sessions de reformulation
- **Index GIN** : `idx_roleplaydata_note_gin` pour recherche dans les notes

### ğŸ¯ **3. SystÃ¨me d'Ã‰valuation QualitÃ©** (4 tables)

#### Architecture d'Ã‰valuation

```
lpltag (critÃ¨res) â†’ turntagged (affectation) â†’ tag_history (audit) â†’ tag_modifications (traÃ§abilitÃ©)
```

#### **Table `lpltag` - Grille de CritÃ¨res QualitÃ©**

```sql
-- Structure des critÃ¨res
label TEXT NOT NULL UNIQUE,     -- Nom du critÃ¨re (clÃ© mÃ©tier)
family TEXT,                   -- Famille de critÃ¨res (Ã‰coute, Argumentation, etc.)
color TEXT NOT NULL,          -- Couleur pour interface
created_at TIMESTAMP         -- Audit crÃ©ation
```

#### **Table `turntagged` - Affectation CritÃ¨res aux Passages**

- **GranularitÃ© temporelle** : `start_time` et `end_time` prÃ©cis dans l'appel
- **Verbatim complet** : Texte exact du passage Ã©valuÃ©
- **Scoring IA** : `score_auto` et `next_turn_tag_auto` pour prÃ©-Ã©valuation
- **Index optimisÃ©s** : 4 index pour performance temps rÃ©el

**Relations critiques** :

```sql
turntagged.call_id â†’ call.callid (CASCADE DELETE)
turntagged.tag â†’ lpltag.label (SET NULL, CASCADE UPDATE)
```

#### Audit Trail Complet

- **`tag_history`** : Historique des modifications de labels
- **`tag_modifications`** : Audit dÃ©taillÃ© avec `previous_data` JSONB

### ğŸ“ **4. Coaching & Plans d'EntraÃ®nement** (4 tables)

#### **Table `activitesconseillers` - Sessions de Coaching**

**CÅ“ur du systÃ¨me de coaching** avec double interface :

```sql
-- Interface mÃ©tier classique
statut TEXT,
commentaires TEXT,
objectifs TEXT,
nature TEXT,

-- Interface sidebar optimisÃ©e (temps rÃ©el)
sidebar_phase VARCHAR(50),      -- 'selection', 'evaluation', 'coaching', 'suivi', 'feedback', 'admin'
sidebar_statut VARCHAR(50),     -- 'Ã  faire', 'en cours', 'rÃ©alisÃ©'
sidebar_objectifs TEXT,
sidebar_commentaires TEXT,
sidebar_date_modif TIMESTAMP WITH TIME ZONE DEFAULT now()
```

**Index spÃ©cialisÃ©s pour performance UI** :

```sql
-- Optimisation interface sidebar
CREATE INDEX idx_activitesconseillers_sidebar_phase ON activitesconseillers (sidebar_phase);
CREATE INDEX idx_activitesconseillers_sidebar_conseiller ON activitesconseillers (idconseiller, sidebar_phase);
CREATE INDEX idx_activitesconseillers_sidebar_statut ON activitesconseillers (sidebar_statut);
```

#### **Table `pratiques` - CompÃ©tences Ã‰valuÃ©es**

```sql
-- Guides diffÃ©renciÃ©s par rÃ´le
fiche_conseiller_json JSONB,   -- Guide pour le conseiller
fiche_coach_json JSONB,        -- Guide pour le coach
jeuderole JSONB,              -- ScÃ©narios de re-simulation IA
valeurnumÃ©rique INTEGER DEFAULT 1,  -- PondÃ©ration dans l'Ã©valuation
geste TEXT                    -- Action corrective recommandÃ©e
```

#### Relations de Coaching

```sql
-- Workflow de coaching
activitesconseillers.idconseiller â†’ conseillers.idconseiller (NO ACTION)
activitesconseillers.idpratique â†’ pratiques.idpratique (NO ACTION)
activitesconseillers.idexercice â†’ exercices.idexercice (NO ACTION)
exercices.idpratique â†’ pratiques.idpratique (NO ACTION)
```

### ğŸ’¡ **5. SystÃ¨me de Nudges & Feedback** (4 tables)

#### Pipeline de Nudges PersonnalisÃ©s

```
nudge (standards) â†’ customnudges (personnalisÃ©s) â†’ avisexercicesnudges (feedback)
```

#### **Table `nudge` - Nudges Standards**

```sql
-- 6 nudges par entrÃ©e pour plans d'entraÃ®nement complets
nudge1 TEXT, nudge2 TEXT, nudge3 TEXT,
nudge4 TEXT, nudge5 TEXT, nudge6 TEXT,
created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
```

#### **Table `customnudges` - Personnalisation**

- **Modifications JSONB** : Adaptations des nudges standards par conseiller
- **Relations protÃ©gÃ©es** : Liens avec `activitesconseillers` et `nudge` (NO ACTION)

#### **Tables de Support**

- **`custom_nudges`** : Version alternative avec dates planifiÃ©es
- **`exercices_nudges`** : Association exercices â†” nudges
- **`avisexercicesnudges`** : Feedback d'efficacitÃ© pour amÃ©lioration continue

### ğŸ“š **6. DonnÃ©es de RÃ©fÃ©rence** (4 tables)

#### **Table `sujets` & `domaines` - Contexte MÃ©tier**

```sql
-- HiÃ©rarchie mÃ©tier
domaines (secteur) â†’ sujets (type d'appel) â†’ categoriessujets (classification)
```

#### **Table `ponderation_sujets` - Scoring Business**

```sql
-- PondÃ©ration selon importance mÃ©tier
conforme INTEGER DEFAULT 10,
partiellement_conforme INTEGER DEFAULT 5,
non_conforme INTEGER DEFAULT 0,
permet_partiellement_conforme BOOLEAN DEFAULT true
```

#### Relations de RÃ©fÃ©rence

- **`sujetspratiques`** : Importance des pratiques par type de sujet
- Configuration flexible par entreprise via `entreprise_domaines` et `entreprise_pratiques`

### ğŸ“Š **7. SystÃ¨me d'Audit & Logs** (6 tables)

#### **Table `logs` - Audit Applicatif**

```sql
timestamp TIMESTAMP WITH TIME ZONE DEFAULT now(),
level TEXT,                    -- Niveau de log
message TEXT,                 -- Message principal
details JSONB                 -- DÃ©tails structurÃ©s
```

#### **Sessions Utilisateurs**

- **`user_sessions`** : Sessions actuelles (user_id TEXT)
- **`user_sessions_backup`** : Audit complet (user_id UUID + session_id UUID)

#### **Quiz d'Ã‰valuation Continue**

```sql
-- Table quiz : Questions gÃ©nÃ©rÃ©es depuis les appels
quiz.callid â†’ call.callid,           -- Quiz basÃ© sur appel spÃ©cifique
quiz.wordid â†’ word.wordid,           -- Question sur passage prÃ©cis
possibleanswers ARRAY,               -- Choix multiples
correctanswerindexes ARRAY,          -- Bonnes rÃ©ponses
quizdata JSONB                       -- DonnÃ©es Ã©tendues

-- Table quiz_responses : Suivi progression
quiz_responses.conseillerid â†’ conseillers.idconseiller,
answers ARRAY,                       -- RÃ©ponses donnÃ©es
submitted_at TIMESTAMP              -- Horodatage
```

### ğŸ”§ **8. Tables Techniques & Support** (14 tables)

#### **Tables de Liaison**

- **`activitesconseillers_pratiques`** : Many-to-Many activitÃ©s â†” pratiques
- **`activitesconseillers_sujets`** : Many-to-Many activitÃ©s â†” sujets
- **`callactivityrelation`** : Many-to-Many appels â†” activitÃ©s
- **`entreprise_call`** : Many-to-Many entreprises â†” appels
- **`entreprise_domaines`** : Configuration domaines par entreprise
- **`entreprise_pratiques`** : Grilles qualitÃ© spÃ©cifiques par entreprise

#### **Tables SpÃ©cialisÃ©es**

- **`postit`** : Ã‰lÃ©ments collaboratifs whiteboard (rÃ©fÃ©rence `word` pour prÃ©cision)
- **`icon`** : Annotations visuelles sur les mots (`data` JSONB)
- **`motifs_afpa`** : Configuration spÃ©cifique client AFPA
- **`deroule_coaching`** : Templates de dÃ©roulÃ© de session
- **`word_tag`** : Tagging manuel des mots

## Patterns et Conventions Architecturales

### ğŸ”‘ **StratÃ©gies de ClÃ©s et SÃ©quences**

#### Conventions de Nommage

- **Tables principales** : `idX` (ex: `idconseiller`, `idpratique`)
- **Tables de liaison** : `id` simple avec sÃ©quence dÃ©diÃ©e
- **Tables d'audit** : `id` avec prÃ©fixe descriptif

#### Gestion des SÃ©quences

- **39 sÃ©quences** pour auto-incrÃ©mentation
- **Type INTEGER** : Standard pour la plupart des tables
- **Type BIGINT** : `entreprises.identreprise` et `nudge.id` pour volumÃ©trie

### ğŸ”— **StratÃ©gies de Relations**

#### **CASCADE DELETE** (Protection des DonnÃ©es)

```sql
-- Suppression d'une entreprise = suppression de ses conseillers
conseillers.entreprise â†’ entreprises.identreprise (CASCADE DELETE)

-- Suppression d'un appel = suppression de toutes ses analyses
transcript.callid â†’ call.callid (CASCADE DELETE)
word.transcriptid â†’ transcript.transcriptid (CASCADE DELETE)
turntagged.call_id â†’ call.callid (CASCADE DELETE)
roleplaydata.call_id â†’ call.callid (CASCADE DELETE)
```

#### **NO ACTION** (Protection de l'Historique)

```sql
-- Protection des sessions de coaching
activitesconseillers.idconseiller â†’ conseillers.idconseiller (NO ACTION)
activitesconseillers.idexercice â†’ exercices.idexercice (NO ACTION)

-- Protection des donnÃ©es de rÃ©fÃ©rence
pratiques.idcategoriepratique â†’ categoriespratiques.idcategoriepratique (NO ACTION)
```

#### **SET NULL / CASCADE UPDATE** (FlexibilitÃ©)

```sql
-- Les tags peuvent Ãªtre modifiÃ©s sans casser les Ã©valuations
turntagged.tag â†’ lpltag.label (SET NULL, CASCADE UPDATE)
```

### ğŸ“Š **Optimisations Performance**

#### **Index SpÃ©cialisÃ©s Interface**

```sql
-- Optimisation sidebar temps rÃ©el (3 index dÃ©diÃ©s)
idx_activitesconseillers_sidebar_phase
idx_activitesconseillers_sidebar_conseiller
idx_activitesconseillers_sidebar_statut
```

#### **Index GranularitÃ© Temporelle**

```sql
-- Optimisation recherche dans les appels
idx_call_id_start_time ON turntagged (call_id, start_time)
idx_start_time, idx_end_time ON turntagged
```

#### **Index JSON AvancÃ©s**

```sql
-- Recherche dans les notes de jeu de rÃ´le
idx_roleplaydata_note_gin ON roleplaydata USING gin (note)
```

### ğŸ“ **Structures JSONB Complexes**

#### **`call.transcription` - Structure de Transcription**

```json
{
  "words": [
    {
      "word": "Bonjour",
      "startTime": 0.5,
      "endTime": 1.2,
      "confidence": 0.95,
      "speaker": "conseiller"
    }
  ],
  "segments": [
    {
      "start": 0.5,
      "end": 15.2,
      "text": "Bonjour, merci d'appeler notre service...",
      "speaker": "conseiller"
    }
  ],
  "metadata": {
    "duration": 120.5,
    "language": "fr",
    "speakers": ["conseiller", "client"]
  }
}
```

#### **`pratiques.jeuderole` - ScÃ©narios IA**

```json
{
  "scenario": "Gestion objection prix",
  "context": "Client trouve le produit trop cher",
  "alternative_approaches": [
    "Argumentation valeur",
    "Comparaison concurrence",
    "Proposition alternative"
  ],
  "ai_prompts": [
    "Reformule cette phrase pour valoriser le ROI",
    "Propose 3 alternatives moins directes"
  ],
  "success_criteria": ["Objection traitÃ©e", "Client rÃ©ceptif"]
}
```

#### **`exercices.nudges` - Plans d'EntraÃ®nement**

```json
{
  "frequency": "2x/jour pendant 3 jours",
  "reminders": [
    {
      "time": "09:00",
      "message": "Exercice Ã©coute active : 5 min de pratique"
    }
  ],
  "micro_learning": [
    "VidÃ©o 2 min : Techniques de reformulation",
    "Quiz : Identifier les signaux client"
  ],
  "self_assessment": {
    "questions": ["Ai-je laissÃ© le client finir ?"],
    "scale": "1-5"
  }
}
```

## Contraintes Business et Ã‰numÃ©rations

### **Contraintes d'IntÃ©gritÃ© MÃ©tier**

#### **`activitesconseillers` - Workflow de Coaching**

```sql
-- Phases de coaching constraintes
CHECK sidebar_phase IN ('selection', 'evaluation', 'coaching', 'suivi', 'feedback', 'admin')

-- Statuts de session constraintes
CHECK sidebar_statut IN ('Ã  faire', 'en cours', 'rÃ©alisÃ©')
```

#### **Contraintes d'UnicitÃ© Business**

```sql
-- Un conseiller ne peut avoir qu'un custom_nudge par activitÃ©
UNIQUE (id_activite) ON custom_nudges

-- Un appel ne peut avoir qu'un motif AFPA
UNIQUE (callid) ON motifs_afpa

-- Un conseiller/activitÃ©/sujet unique
UNIQUE (idactivite, idsujet) ON activitesconseillers_sujets
```

## IntÃ©grations Cross-SchÃ©mas

### **Relations vers Autres SchÃ©mas**

#### **Vers `linguistic` (Analyse IA)**

```sql
-- Les analyses IA suivent les Ã©valuations manuelles
linguistic.verbatims_metadata.turn_id â†’ public.turntagged.id (CASCADE DELETE)
linguistic.verbatims_models_results.turn_id â†’ public.turntagged.id (CASCADE DELETE)
```

#### **Vers `whiteboard` (Collaboration)**

```sql
-- Ã‰valuations collaboratives granulaires
whiteboard.participant_evaluations.call_id â†’ public.call.callid (NO ACTION)
whiteboard.participant_evaluations.word_start_id â†’ public.word.wordid (NO ACTION)
whiteboard.participant_evaluations.assigned_pratique_id â†’ public.pratiques.idpratique (NO ACTION)
```

#### **Vers `auth` (Audit)**

```sql
-- TraÃ§abilitÃ© des connexions
public.user_sessions_backup.user_id â†’ auth.users.id (NO ACTION)
```

## Workflow Principal et Flux de DonnÃ©es

### **Pipeline Complet : Appel â†’ Coaching â†’ Suivi**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Upload Appel â”‚ -> â”‚call.transcription   â”‚ -> â”‚trigger_update_  â”‚
â”‚             â”‚    â”‚(JSONB)              â”‚    â”‚duree()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚transcript ->    â”‚ <- â”‚                     â”‚ <-------â”˜
â”‚word (analyse    â”‚    â”‚                     â”‚
â”‚mot par mot)     â”‚    â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Ã‰valuation Manuelle: â”‚ -> â”‚Analyse IA:          â”‚
â”‚turntagged           â”‚    â”‚linguistic.*         â”‚
â”‚(affectation         â”‚    â”‚(verbatims_metadata, â”‚
â”‚critÃ¨res qualitÃ©)    â”‚    â”‚verbatims_results)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚
        v                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚Session Coaching:    â”‚ <------------â”˜
â”‚activitesconseillers â”‚
â”‚(sidebar_phase:      â”‚
â”‚'coaching')          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Jeu de RÃ´le:         â”‚ -> â”‚Plan Nudges:         â”‚
â”‚roleplaydata         â”‚    â”‚customnudges         â”‚
â”‚(reformulation IA)   â”‚    â”‚(plan personnalisÃ©)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚
        v                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚Quiz Ã‰valuation:     â”‚ <------------â”˜
â”‚quiz + quiz_responsesâ”‚
â”‚(mesure progression) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Feedback:            â”‚
â”‚avisexercicesnudges  â”‚
â”‚(amÃ©lioration        â”‚
â”‚continue)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Ã‰tats de Progression**

#### **call.status**

- `'non_supervisÃ©'` â†’ `'en_cours'` â†’ `'Ã©valuÃ©'` â†’ `'coaching_planifiÃ©'` â†’ `'terminÃ©'`

#### **activitesconseillers.sidebar_statut**

- `'Ã  faire'` â†’ `'en cours'` â†’ `'rÃ©alisÃ©'`

#### **activitesconseillers.sidebar_phase**

- `'selection'` â†’ `'evaluation'` â†’ `'coaching'` â†’ `'suivi'` â†’ `'feedback'`

## Recommandations et Bonnes Pratiques

### **ğŸš€ Optimisations Performance**

#### **RequÃªtes FrÃ©quentes OptimisÃ©es**

```sql
-- Dashboard conseiller (utilise index composite)
SELECT * FROM activitesconseillers
WHERE idconseiller = ? AND sidebar_phase = 'en_cours';

-- Recherche dans les Ã©valuations (utilise index temporel)
SELECT * FROM turntagged
WHERE call_id = ? AND start_time BETWEEN ? AND ?;
```

#### **Maintenance RecommandÃ©e**

- **Archivage** : `call.archived = true` aprÃ¨s 2 ans
- **Purge logs** : Logs > 6 mois dans table d'archive
- **RÃ©indexation** : Index GIN sur JSONB selon volumÃ©trie

### **ğŸ” SÃ©curitÃ© et ConformitÃ©**

#### **DonnÃ©es Sensibles**

- **`call.transcription`** : Conversations clients â†’ Chiffrement via pgsodium
- **`conseillers.estanonyme`** : Anonymisation pour conformitÃ©
- **`user_sessions_backup`** : Audit complet avec UUID pour traÃ§abilitÃ© RGPD

#### **StratÃ©gies de Suppression**

- **Soft delete** : Utiliser `archived` plutÃ´t que DELETE sur `call`
- **Anonymisation** : SET NULL sur `turntagged.tag` prÃ©serve les Ã©valuations
- **Audit prÃ©servÃ©** : NO ACTION sur `user_sessions_backup` pour conformitÃ©

---

## Conclusion

Le schÃ©ma `public` rÃ©vÃ¨le une architecture mÃ©tier sophistiquÃ©e qui dÃ©passe largement le simple coaching tÃ©lÃ©phonique. Avec ses **8 domaines fonctionnels intÃ©grÃ©s** , ses **optimisations temps rÃ©el** et ses **structures JSONB flexibles** , il constitue le socle d'une plateforme d'Ã©valuation qualitÃ© de nouvelle gÃ©nÃ©ration.

L'architecture **multi-interface** (mÃ©tier + sidebar), les **relations protÃ©gÃ©es** et les **automatisations intelligentes** (trigger durÃ©e, scoring IA) dÃ©montrent une maturitÃ© technique qui positionne 000-CADO comme une solution enterprise de rÃ©fÃ©rence dans le domaine de l'Ã©valuation qualitÃ© et du coaching assistÃ© par IA.

<style>#mermaid-1749792964503{font-family:sans-serif;font-size:16px;fill:#333;}#mermaid-1749792964503 .error-icon{fill:#552222;}#mermaid-1749792964503 .error-text{fill:#552222;stroke:#552222;}#mermaid-1749792964503 .edge-thickness-normal{stroke-width:2px;}#mermaid-1749792964503 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1749792964503 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1749792964503 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1749792964503 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1749792964503 .marker{fill:#333333;}#mermaid-1749792964503 .marker.cross{stroke:#333333;}#mermaid-1749792964503 svg{font-family:sans-serif;font-size:16px;}#mermaid-1749792964503 .label{font-family:sans-serif;color:#333;}#mermaid-1749792964503 .label text{fill:#333;}#mermaid-1749792964503 .node rect,#mermaid-1749792964503 .node circle,#mermaid-1749792964503 .node ellipse,#mermaid-1749792964503 .node polygon,#mermaid-1749792964503 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1749792964503 .node .label{text-align:center;}#mermaid-1749792964503 .node.clickable{cursor:pointer;}#mermaid-1749792964503 .arrowheadPath{fill:#333333;}#mermaid-1749792964503 .edgePath .path{stroke:#333333;stroke-width:1.5px;}#mermaid-1749792964503 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1749792964503 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1749792964503 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1749792964503 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1749792964503 .cluster text{fill:#333;}#mermaid-1749792964503 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:sans-serif;font-size:12px;background:hsl(80,100%,96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1749792964503:root{--mermaid-font-family:sans-serif;}#mermaid-1749792964503:root{--mermaid-alt-font-family:sans-serif;}#mermaid-1749792964503 flowchart{fill:apa;}</style>
