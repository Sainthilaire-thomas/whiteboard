# Documentation Sch√©ma Public - 000-CADO

## Vue d'Ensemble

Le sch√©ma `public` constitue le **c≈ìur m√©tier** de la plateforme 000-CADO avec **46 tables** organis√©es en **8 domaines fonctionnels** . Il orchestre le pipeline complet : **Appel ‚Üí √âvaluation ‚Üí Coaching ‚Üí Suivi** , tout en servant de hub central pour les relations avec les 11 autres sch√©mas sp√©cialis√©s.

### Statistiques G√©n√©rales

- **46 tables** r√©parties en 8 domaines fonctionnels
- **39 s√©quences** pour auto-incr√©mentation
- **58 index** dont 3 sp√©cialis√©s pour l'interface sidebar
- **48 relations** intra-sch√©ma + 18 relations cross-sch√©mas
- **13 colonnes JSONB** pour structures de donn√©es complexes
- **1 trigger automatique** pour calcul de dur√©e des appels

## Architecture par Domaines Fonctionnels

### üè¢ **1. Gestion Utilisateurs & Entreprises** (6 tables)

#### Tables Principales

- **`users`** : Utilisateurs de la plateforme (coaches, administrateurs)
- **`entreprises`** : Entreprises clientes multi-tenant
- **`conseillers`** : Conseillers/coaches rattach√©s aux entreprises
- **`avatars`** : Avatars pour personnalisation et anonymisation
- **`user_enterprises`** : Relation Many-to-Many utilisateurs ‚Üî entreprises
- **`user_roles`** : R√¥les personnalis√©s par utilisateur

#### Relations Cl√©s

```sql
-- Architecture multi-tenant s√©curis√©e
users.entreprise_id ‚Üí entreprises.identreprise (NO ACTION)
conseillers.entreprise ‚Üí entreprises.identreprise (CASCADE DELETE)
conseillers.idavatar ‚Üí avatars.idavatar (NO ACTION)
```

#### Particularit√©s

- **Anonymisation** : `conseillers.estanonyme` + `avatars.anonyme` pour protection identit√©
- **Multi-appartenance** : Table `user_enterprises` pour utilisateurs multi-entreprises
- **S√©curit√© forte** : Email unique sur `users` et `conseillers`

### üìû **2. Gestion des Appels & Transcriptions** (4 tables)

#### Pipeline de Transcription

```
call (enregistrement) ‚Üí transcript (structure) ‚Üí word (mot-par-mot) ‚Üí roleplaydata (jeu de r√¥le)
```

#### **Table `call` - Hub Central des Appels**

```sql
-- Colonnes critiques
transcription JSONB,           -- Structure compl√®te avec timestamps
duree NUMERIC,                -- Calcul√©e automatiquement par trigger
status VARCHAR(20) DEFAULT 'non_supervis√©',  -- Pipeline d'√©valuation
is_tagging_call BOOLEAN DEFAULT false        -- Appel en cours d'√©valuation
```

**Trigger Automatique** :

```sql
CREATE TRIGGER trigger_update_duree
BEFORE INSERT OR UPDATE ON call
FOR EACH ROW EXECUTE FUNCTION update_duree();
```

#### **Table `word` - Analyse Granulaire**

- **Granularit√© maximale** : Chaque mot avec `startTime` et `endTime`
- **R√©f√©rencement pr√©cis** : Utilis√© par `whiteboard` pour annotations mot-par-mot
- **Relations CASCADE** : `word.transcriptid ‚Üí transcript.transcriptid`

#### **Table `roleplaydata` - Jeu de R√¥le IA**

- **Int√©gration whiteboard** : `postit_id` pour collaboration temps r√©el
- **Donn√©es JSON** : `note` pour stockage des sessions de reformulation
- **Index GIN** : `idx_roleplaydata_note_gin` pour recherche dans les notes

### üéØ **3. Syst√®me d'√âvaluation Qualit√©** (4 tables)

#### Architecture d'√âvaluation

```
lpltag (crit√®res) ‚Üí turntagged (affectation) ‚Üí tag_history (audit) ‚Üí tag_modifications (tra√ßabilit√©)
```

#### **Table `lpltag` - Grille de Crit√®res Qualit√©**

```sql
-- Structure des crit√®res
label TEXT NOT NULL UNIQUE,     -- Nom du crit√®re (cl√© m√©tier)
family TEXT,                   -- Famille de crit√®res (√âcoute, Argumentation, etc.)
color TEXT NOT NULL,          -- Couleur pour interface
created_at TIMESTAMP         -- Audit cr√©ation
```

#### **Table `turntagged` - Affectation Crit√®res aux Passages**

- **Granularit√© temporelle** : `start_time` et `end_time` pr√©cis dans l'appel
- **Verbatim complet** : Texte exact du passage √©valu√©
- **Scoring IA** : `score_auto` et `next_turn_tag_auto` pour pr√©-√©valuation
- **Index optimis√©s** : 4 index pour performance temps r√©el

**Relations critiques** :

```sql
turntagged.call_id ‚Üí call.callid (CASCADE DELETE)
turntagged.tag ‚Üí lpltag.label (SET NULL, CASCADE UPDATE)
```

#### Audit Trail Complet

- **`tag_history`** : Historique des modifications de labels
- **`tag_modifications`** : Audit d√©taill√© avec `previous_data` JSONB

### üéì **4. Coaching & Plans d'Entra√Ænement** (4 tables)

#### **Table `activitesconseillers` - Sessions de Coaching**

**C≈ìur du syst√®me de coaching** avec double interface :

```sql
-- Interface m√©tier classique
statut TEXT,
commentaires TEXT,
objectifs TEXT,
nature TEXT,

-- Interface sidebar optimis√©e (temps r√©el)
sidebar_phase VARCHAR(50),      -- 'selection', 'evaluation', 'coaching', 'suivi', 'feedback', 'admin'
sidebar_statut VARCHAR(50),     -- '√† faire', 'en cours', 'r√©alis√©'
sidebar_objectifs TEXT,
sidebar_commentaires TEXT,
sidebar_date_modif TIMESTAMP WITH TIME ZONE DEFAULT now()
```

**Index sp√©cialis√©s pour performance UI** :

```sql
-- Optimisation interface sidebar
CREATE INDEX idx_activitesconseillers_sidebar_phase ON activitesconseillers (sidebar_phase);
CREATE INDEX idx_activitesconseillers_sidebar_conseiller ON activitesconseillers (idconseiller, sidebar_phase);
CREATE INDEX idx_activitesconseillers_sidebar_statut ON activitesconseillers (sidebar_statut);
```

#### **Table `pratiques` - Comp√©tences √âvalu√©es**

```sql
-- Guides diff√©renci√©s par r√¥le
fiche_conseiller_json JSONB,   -- Guide pour le conseiller
fiche_coach_json JSONB,        -- Guide pour le coach
jeuderole JSONB,              -- Sc√©narios de re-simulation IA
valeurnum√©rique INTEGER DEFAULT 1,  -- Pond√©ration dans l'√©valuation
geste TEXT                    -- Action corrective recommand√©e
```

#### Relations de Coaching

```sql
-- Workflow de coaching
activitesconseillers.idconseiller ‚Üí conseillers.idconseiller (NO ACTION)
activitesconseillers.idpratique ‚Üí pratiques.idpratique (NO ACTION)
activitesconseillers.idexercice ‚Üí exercices.idexercice (NO ACTION)
exercices.idpratique ‚Üí pratiques.idpratique (NO ACTION)
```

### üí° **5. Syst√®me de Nudges & Feedback** (4 tables)

#### Pipeline de Nudges Personnalis√©s

```
nudge (standards) ‚Üí customnudges (personnalis√©s) ‚Üí avisexercicesnudges (feedback)
```

#### **Table `nudge` - Nudges Standards**

```sql
-- 6 nudges par entr√©e pour plans d'entra√Ænement complets
nudge1 TEXT, nudge2 TEXT, nudge3 TEXT,
nudge4 TEXT, nudge5 TEXT, nudge6 TEXT,
created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
```

#### **Table `customnudges` - Personnalisation**

- **Modifications JSONB** : Adaptations des nudges standards par conseiller
- **Relations prot√©g√©es** : Liens avec `activitesconseillers` et `nudge` (NO ACTION)

#### **Tables de Support**

- **`custom_nudges`** : Version alternative avec dates planifi√©es
- **`exercices_nudges`** : Association exercices ‚Üî nudges
- **`avisexercicesnudges`** : Feedback d'efficacit√© pour am√©lioration continue

### üìö **6. Donn√©es de R√©f√©rence** (4 tables)

#### **Table `sujets` & `domaines` - Contexte M√©tier**

```sql
-- Hi√©rarchie m√©tier
domaines (secteur) ‚Üí sujets (type d'appel) ‚Üí categoriessujets (classification)
```

#### **Table `ponderation_sujets` - Scoring Business**

```sql
-- Pond√©ration selon importance m√©tier
conforme INTEGER DEFAULT 10,
partiellement_conforme INTEGER DEFAULT 5,
non_conforme INTEGER DEFAULT 0,
permet_partiellement_conforme BOOLEAN DEFAULT true
```

#### Relations de R√©f√©rence

- **`sujetspratiques`** : Importance des pratiques par type de sujet
- Configuration flexible par entreprise via `entreprise_domaines` et `entreprise_pratiques`

### üìä **7. Syst√®me d'Audit & Logs** (6 tables)

#### **Table `logs` - Audit Applicatif**

```sql
timestamp TIMESTAMP WITH TIME ZONE DEFAULT now(),
level TEXT,                    -- Niveau de log
message TEXT,                 -- Message principal
details JSONB                 -- D√©tails structur√©s
```

#### **Sessions Utilisateurs**

- **`user_sessions`** : Sessions actuelles (user_id TEXT)
- **`user_sessions_backup`** : Audit complet (user_id UUID + session_id UUID)

#### **Quiz d'√âvaluation Continue**

```sql
-- Table quiz : Questions g√©n√©r√©es depuis les appels
quiz.callid ‚Üí call.callid,           -- Quiz bas√© sur appel sp√©cifique
quiz.wordid ‚Üí word.wordid,           -- Question sur passage pr√©cis
possibleanswers ARRAY,               -- Choix multiples
correctanswerindexes ARRAY,          -- Bonnes r√©ponses
quizdata JSONB                       -- Donn√©es √©tendues

-- Table quiz_responses : Suivi progression
quiz_responses.conseillerid ‚Üí conseillers.idconseiller,
answers ARRAY,                       -- R√©ponses donn√©es
submitted_at TIMESTAMP              -- Horodatage
```

### üîß **8. Tables Techniques & Support** (14 tables)

#### **Tables de Liaison**

- **`activitesconseillers_pratiques`** : Many-to-Many activit√©s ‚Üî pratiques
- **`activitesconseillers_sujets`** : Many-to-Many activit√©s ‚Üî sujets
- **`callactivityrelation`** : Many-to-Many appels ‚Üî activit√©s
- **`entreprise_call`** : Many-to-Many entreprises ‚Üî appels
- **`entreprise_domaines`** : Configuration domaines par entreprise
- **`entreprise_pratiques`** : Grilles qualit√© sp√©cifiques par entreprise

#### **Tables Sp√©cialis√©es**

- **`postit`** : √âl√©ments collaboratifs whiteboard (r√©f√©rence `word` pour pr√©cision)
- **`icon`** : Annotations visuelles sur les mots (`data` JSONB)
- **`motifs_afpa`** : Configuration sp√©cifique client AFPA
- **`deroule_coaching`** : Templates de d√©roul√© de session
- **`word_tag`** : Tagging manuel des mots

## Patterns et Conventions Architecturales

### üîë **Strat√©gies de Cl√©s et S√©quences**

#### Conventions de Nommage

- **Tables principales** : `idX` (ex: `idconseiller`, `idpratique`)
- **Tables de liaison** : `id` simple avec s√©quence d√©di√©e
- **Tables d'audit** : `id` avec pr√©fixe descriptif

#### Gestion des S√©quences

- **39 s√©quences** pour auto-incr√©mentation
- **Type INTEGER** : Standard pour la plupart des tables
- **Type BIGINT** : `entreprises.identreprise` et `nudge.id` pour volum√©trie

### üîó **Strat√©gies de Relations**

#### **CASCADE DELETE** (Protection des Donn√©es)

```sql
-- Suppression d'une entreprise = suppression de ses conseillers
conseillers.entreprise ‚Üí entreprises.identreprise (CASCADE DELETE)

-- Suppression d'un appel = suppression de toutes ses analyses
transcript.callid ‚Üí call.callid (CASCADE DELETE)
word.transcriptid ‚Üí transcript.transcriptid (CASCADE DELETE)
turntagged.call_id ‚Üí call.callid (CASCADE DELETE)
roleplaydata.call_id ‚Üí call.callid (CASCADE DELETE)
```

#### **NO ACTION** (Protection de l'Historique)

```sql
-- Protection des sessions de coaching
activitesconseillers.idconseiller ‚Üí conseillers.idconseiller (NO ACTION)
activitesconseillers.idexercice ‚Üí exercices.idexercice (NO ACTION)

-- Protection des donn√©es de r√©f√©rence
pratiques.idcategoriepratique ‚Üí categoriespratiques.idcategoriepratique (NO ACTION)
```

#### **SET NULL / CASCADE UPDATE** (Flexibilit√©)

```sql
-- Les tags peuvent √™tre modifi√©s sans casser les √©valuations
turntagged.tag ‚Üí lpltag.label (SET NULL, CASCADE UPDATE)
```

### üìä **Optimisations Performance**

#### **Index Sp√©cialis√©s Interface**

```sql
-- Optimisation sidebar temps r√©el (3 index d√©di√©s)
idx_activitesconseillers_sidebar_phase
idx_activitesconseillers_sidebar_conseiller
idx_activitesconseillers_sidebar_statut
```

#### **Index Granularit√© Temporelle**

```sql
-- Optimisation recherche dans les appels
idx_call_id_start_time ON turntagged (call_id, start_time)
idx_start_time, idx_end_time ON turntagged
```

#### **Index JSON Avanc√©s**

```sql
-- Recherche dans les notes de jeu de r√¥le
idx_roleplaydata_note_gin ON roleplaydata USING gin (note)
```

### üìù **Structures JSONB Complexes**

#### **`call.transcription` - Structure de Transcription**

```json
{
  "words": [
    {
      "word": "Bonjour",
      "startTime": 0.5,
      "endTime": 1.2,
      "confidence": 0.95,
      "speaker": "conseiller"
    }
  ],
  "segments": [
    {
      "start": 0.5,
      "end": 15.2,
      "text": "Bonjour, merci d'appeler notre service...",
      "speaker": "conseiller"
    }
  ],
  "metadata": {
    "duration": 120.5,
    "language": "fr",
    "speakers": ["conseiller", "client"]
  }
}
```

#### **`pratiques.jeuderole` - Sc√©narios IA**

```json
{
  "scenario": "Gestion objection prix",
  "context": "Client trouve le produit trop cher",
  "alternative_approaches": [
    "Argumentation valeur",
    "Comparaison concurrence",
    "Proposition alternative"
  ],
  "ai_prompts": [
    "Reformule cette phrase pour valoriser le ROI",
    "Propose 3 alternatives moins directes"
  ],
  "success_criteria": ["Objection trait√©e", "Client r√©ceptif"]
}
```

#### **`exercices.nudges` - Plans d'Entra√Ænement**

```json
{
  "frequency": "2x/jour pendant 3 jours",
  "reminders": [
    {
      "time": "09:00",
      "message": "Exercice √©coute active : 5 min de pratique"
    }
  ],
  "micro_learning": [
    "Vid√©o 2 min : Techniques de reformulation",
    "Quiz : Identifier les signaux client"
  ],
  "self_assessment": {
    "questions": ["Ai-je laiss√© le client finir ?"],
    "scale": "1-5"
  }
}
```

## Contraintes Business et √ânum√©rations

### **Contraintes d'Int√©grit√© M√©tier**

#### **`activitesconseillers` - Workflow de Coaching**

```sql
-- Phases de coaching constraintes
CHECK sidebar_phase IN ('selection', 'evaluation', 'coaching', 'suivi', 'feedback', 'admin')

-- Statuts de session constraintes
CHECK sidebar_statut IN ('√† faire', 'en cours', 'r√©alis√©')
```

#### **Contraintes d'Unicit√© Business**

```sql
-- Un conseiller ne peut avoir qu'un custom_nudge par activit√©
UNIQUE (id_activite) ON custom_nudges

-- Un appel ne peut avoir qu'un motif AFPA
UNIQUE (callid) ON motifs_afpa

-- Un conseiller/activit√©/sujet unique
UNIQUE (idactivite, idsujet) ON activitesconseillers_sujets
```

## Int√©grations Cross-Sch√©mas

### **Relations vers Autres Sch√©mas**

#### **Vers `linguistic` (Analyse IA)**

```sql
-- Les analyses IA suivent les √©valuations manuelles
linguistic.verbatims_metadata.turn_id ‚Üí public.turntagged.id (CASCADE DELETE)
linguistic.verbatims_models_results.turn_id ‚Üí public.turntagged.id (CASCADE DELETE)
```

#### **Vers `whiteboard` (Collaboration)**

```sql
-- √âvaluations collaboratives granulaires
whiteboard.participant_evaluations.call_id ‚Üí public.call.callid (NO ACTION)
whiteboard.participant_evaluations.word_start_id ‚Üí public.word.wordid (NO ACTION)
whiteboard.participant_evaluations.assigned_pratique_id ‚Üí public.pratiques.idpratique (NO ACTION)
```

#### **Vers `auth` (Audit)**

```sql
-- Tra√ßabilit√© des connexions
public.user_sessions_backup.user_id ‚Üí auth.users.id (NO ACTION)
```

## Workflow Principal et Flux de Donn√©es

### **Pipeline Complet : Appel ‚Üí Coaching ‚Üí Suivi**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇUpload Appel ‚îÇ -> ‚îÇcall.transcription   ‚îÇ -> ‚îÇtrigger_update_  ‚îÇ
‚îÇ             ‚îÇ    ‚îÇ(JSONB)              ‚îÇ    ‚îÇduree()          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                        ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇtranscript ->    ‚îÇ <- ‚îÇ                     ‚îÇ <-------‚îò
‚îÇword (analyse    ‚îÇ    ‚îÇ                     ‚îÇ
‚îÇmot par mot)     ‚îÇ    ‚îÇ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ√âvaluation Manuelle: ‚îÇ -> ‚îÇAnalyse IA:          ‚îÇ
‚îÇturntagged           ‚îÇ    ‚îÇlinguistic.*         ‚îÇ
‚îÇ(affectation         ‚îÇ    ‚îÇ(verbatims_metadata, ‚îÇ
‚îÇcrit√®res qualit√©)    ‚îÇ    ‚îÇverbatims_results)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                           ‚îÇ
        v                           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇSession Coaching:    ‚îÇ <------------‚îò
‚îÇactivitesconseillers ‚îÇ
‚îÇ(sidebar_phase:      ‚îÇ
‚îÇ'coaching')          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇJeu de R√¥le:         ‚îÇ -> ‚îÇPlan Nudges:         ‚îÇ
‚îÇroleplaydata         ‚îÇ    ‚îÇcustomnudges         ‚îÇ
‚îÇ(reformulation IA)   ‚îÇ    ‚îÇ(plan personnalis√©)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                           ‚îÇ
        v                           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇQuiz √âvaluation:     ‚îÇ <------------‚îò
‚îÇquiz + quiz_responses‚îÇ
‚îÇ(mesure progression) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇFeedback:            ‚îÇ
‚îÇavisexercicesnudges  ‚îÇ
‚îÇ(am√©lioration        ‚îÇ
‚îÇcontinue)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **√âtats de Progression**

#### **call.status**

- `'non_supervis√©'` ‚Üí `'en_cours'` ‚Üí `'√©valu√©'` ‚Üí `'coaching_planifi√©'` ‚Üí `'termin√©'`

#### **activitesconseillers.sidebar_statut**

- `'√† faire'` ‚Üí `'en cours'` ‚Üí `'r√©alis√©'`

#### **activitesconseillers.sidebar_phase**

- `'selection'` ‚Üí `'evaluation'` ‚Üí `'coaching'` ‚Üí `'suivi'` ‚Üí `'feedback'`

## Recommandations et Bonnes Pratiques

### **üöÄ Optimisations Performance**

#### **Requ√™tes Fr√©quentes Optimis√©es**

```sql
-- Dashboard conseiller (utilise index composite)
SELECT * FROM activitesconseillers
WHERE idconseiller = ? AND sidebar_phase = 'en_cours';

-- Recherche dans les √©valuations (utilise index temporel)
SELECT * FROM turntagged
WHERE call_id = ? AND start_time BETWEEN ? AND ?;
```

#### **Maintenance Recommand√©e**

- **Archivage** : `call.archived = true` apr√®s 2 ans
- **Purge logs** : Logs > 6 mois dans table d'archive
- **R√©indexation** : Index GIN sur JSONB selon volum√©trie

### **üîê S√©curit√© et Conformit√©**

#### **Donn√©es Sensibles**

- **`call.transcription`** : Conversations clients ‚Üí Chiffrement via pgsodium
- **`conseillers.estanonyme`** : Anonymisation pour conformit√©
- **`user_sessions_backup`** : Audit complet avec UUID pour tra√ßabilit√© RGPD

#### **Strat√©gies de Suppression**

- **Soft delete** : Utiliser `archived` plut√¥t que DELETE sur `call`
- **Anonymisation** : SET NULL sur `turntagged.tag` pr√©serve les √©valuations
- **Audit pr√©serv√©** : NO ACTION sur `user_sessions_backup` pour conformit√©

---

## Conclusion

Le sch√©ma `public` r√©v√®le une architecture m√©tier sophistiqu√©e qui d√©passe largement le simple coaching t√©l√©phonique. Avec ses **8 domaines fonctionnels int√©gr√©s** , ses **optimisations temps r√©el** et ses **structures JSONB flexibles** , il constitue le socle d'une plateforme d'√©valuation qualit√© de nouvelle g√©n√©ration.

L'architecture **multi-interface** (m√©tier + sidebar), les **relations prot√©g√©es** et les **automatisations intelligentes** (trigger dur√©e, scoring IA) d√©montrent une maturit√© technique qui positionne 000-CADO comme une solution enterprise de r√©f√©rence dans le domaine de l'√©valuation qualit√© et du coaching assist√© par IA.

<style>#mermaid-1749792964503{font-family:sans-serif;font-size:16px;fill:#333;}#mermaid-1749792964503 .error-icon{fill:#552222;}#mermaid-1749792964503 .error-text{fill:#552222;stroke:#552222;}#mermaid-1749792964503 .edge-thickness-normal{stroke-width:2px;}#mermaid-1749792964503 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1749792964503 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1749792964503 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1749792964503 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1749792964503 .marker{fill:#333333;}#mermaid-1749792964503 .marker.cross{stroke:#333333;}#mermaid-1749792964503 svg{font-family:sans-serif;font-size:16px;}#mermaid-1749792964503 .label{font-family:sans-serif;color:#333;}#mermaid-1749792964503 .label text{fill:#333;}#mermaid-1749792964503 .node rect,#mermaid-1749792964503 .node circle,#mermaid-1749792964503 .node ellipse,#mermaid-1749792964503 .node polygon,#mermaid-1749792964503 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1749792964503 .node .label{text-align:center;}#mermaid-1749792964503 .node.clickable{cursor:pointer;}#mermaid-1749792964503 .arrowheadPath{fill:#333333;}#mermaid-1749792964503 .edgePath .path{stroke:#333333;stroke-width:1.5px;}#mermaid-1749792964503 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1749792964503 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1749792964503 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1749792964503 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1749792964503 .cluster text{fill:#333;}#mermaid-1749792964503 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:sans-serif;font-size:12px;background:hsl(80,100%,96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1749792964503:root{--mermaid-font-family:sans-serif;}#mermaid-1749792964503:root{--mermaid-alt-font-family:sans-serif;}#mermaid-1749792964503 flowchart{fill:apa;}</style>
